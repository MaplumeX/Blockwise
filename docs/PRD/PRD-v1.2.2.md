---
文档类型: 产品需求文档 (PRD)
产品名称: Blockwise - 柳比歇夫时间管理 App
版本: v1.2.2
创建日期: 2026-01-21
最后更新: 2026-01-21
文档作者: Product Team
审核状态: 待审核
---

# Blockwise v1.2.2 版本功能需求

## 概述

v1.2.2 在 v1.2.1 的时间线视图基础上补齐“计时入口”：在当天时间线视图提供一个计时按钮，用户选择活动类型后即可开始计时，并以“计时中条目”的形式在时间线中实时呈现；再次点击按钮（按钮文案变为“完成”）即可结束计时并生成一条时间条目。

**主要更新**：
1. 时间线视图新增计时按钮（开始/完成）
2. 开始计时前弹出活动类型选择框
3. 计时中条目在时间线列表中实时展示；完成后写入为标准时间条目
4. 时间条目记录精度提升至秒级；时间线起始/结束时间显示仍保持分钟级

---

## 1. 时间条目记录精度（秒级）与时间线显示（分钟级）（v1.2.2 新增）

### 1.1 目标

在不增加时间线视觉复杂度的前提下，提升时间条目记录的精度以支持更准确的统计、计时与后续扩展（例如更细粒度的计时/导出）。

### 1.2 记录精度（数据）

- **记录精度**：TimeEntry 的起始/结束时间支持到秒（HH:mm:ss）。
- **比较规则**：条目有效性判断使用秒级精度（结束时间必须严格晚于起始时间）。
- **计时写入**：计时开始与完成时刻按系统当前时间写入秒级时间戳。

### 1.3 时间线显示精度（UI）

- **显示精度**：时间线列表中的起始/结束时间仍仅显示到分钟（HH:mm）。
- **显示规则**：显示时对秒进行截断/隐藏（不展示秒，不做四舍五入），例如：
  - 09:00:59 在时间线中显示为 09:00
  - 09:01:01 在时间线中显示为 09:01

### 1.4 成功标准（验收）

- 通过计时创建的 TimeEntry 在数据层保存的起始/结束时间包含秒信息
- 时间线列表对同一条 TimeEntry 的时间展示为 HH:mm（不出现秒）
- 结束时间必须严格晚于起始时间（秒级）；不再依赖“最小时长 1 分钟”来保证有效性

---

## 2. 时间线视图计时入口（v1.2.2 新增）

> 注：本版本提升 TimeEntry 的记录精度为秒级，但时间线视图的起始/结束时间显示仍保持分钟级（见第 1 节）。

### 2.1 功能定位

在“当天时间线视图（Timeline View - Today）”提供稳定、可预期的一键计时入口，降低用户开始记录真实活动的操作成本，尤其适用于“边做边记”的场景。

### 2.2 入口与布局

- **入口形式**：计时按钮（推荐：扩展型悬浮按钮 Extended FAB，支持文案切换）
- **位置**：中间，最新条目的下方
- **默认文案**：开始
- **计时中文案**：完成
- **可见性（约束）**：仅在“时间线视图”且选中日期=今天时展示；选中日期非今天时不展示
- **触摸目标**：不小于 48dp
- **无障碍**：提供明确语义（例如“开始计时”“完成计时”）

### 2.3 开始计时：活动类型选择

- 用户在当天时间线视图点击计时按钮
- 系统弹出“活动类型选择框”（可复用现有活动类型选择器）
- 用户选择一个活动类型后，系统开始计时
- 若用户取消/关闭选择框：不开始计时，不产生条目

### 2.4 计时中条目展示

当计时开始后，系统在当天时间线列表中插入/展示一条“计时中条目”，用于即时反馈当前正在记录的活动。

- **活动类型**：显示为用户所选活动类型
- **时间显示**：
  - 起始时间 = 选择活动类型确认时的当前时间（记录精度到秒；时间线展示仅显示到分钟，见 1.3）
  - 结束时间 = 实时以“现在/进行中”语义展示，并随当前时间更新
- **状态标识**：在条目上显示明确的“计时中/进行中”状态（视觉样式由设计稿定义）
- **列表一致性**：计时中条目完成后，自动转换为普通时间条目，保持在相同日期分组内

### 2.5 完成计时：生成时间条目

- 计时开始后，计时按钮文案切换为“完成”
- 用户点击“完成”后，系统结束计时并创建一条时间条目（TimeEntry）：
  - 活动类型 = 计时开始时选择的活动类型
  - 起始时间 = 计时起始时间
  - 结束时间 = 点击“完成”时的当前时间（记录精度到秒；若结束时间 <= 起始时间，则结束时间 = 起始时间 + 1 秒，保证条目有效）
- 创建成功后：
  - 计时按钮恢复为“开始”
  - 时间线列表刷新并展示该条目为普通条目

### 2.6 规则与边界（约束）

- **单计时器约束**：同一时刻最多只能存在 1 条“计时中条目”。计时中状态下不允许再次进入“开始计时”流程（入口保持为“完成”）。
- **跨日处理**：若计时跨越 24:00:00，写入时按自然日自动拆分为两条时间条目（分界点为 24:00:00/00:00:00），以保证单条记录不跨日。
- **不在 v1.2.2 范围内**：暂停/继续、多计时器并行、系统通知栏控制。

### 2.7 成功标准（验收）

- 点击计时按钮后弹出活动类型选择框；取消选择不会产生条目
- 选择活动类型后，时间线列表出现“计时中条目”，并能随时间变化体现“进行中”
- 计时按钮在计时中状态下显示为“完成”；点击后结束计时并生成普通时间条目
- 生成条目在数据层满足结束时间严格晚于起始时间（最小时长 1 秒；时间线展示仍为分钟级）
