---
文档类型: 技术框架方案文档
产品名称: Blockwise - 柳比歇夫时间管理 App
版本: v1.0
创建日期: 2026-01-15
文档作者: Tech Team
审核状态: 待审核
---

# Blockwise 技术框架方案文档

## 1. 概述

### 1.1 文档目标

本文档旨在为 Blockwise 项目定义整体技术架构、技术选型和关键设计决策，为开发团队提供技术实施的指导方向。

### 1.2 技术原则

- **简洁性优先（KISS）**：选择成熟、简单的技术方案
- **Android官方推荐**：优先采用Google官方支持的技术栈
- **性能为先**：确保大数据量下的流畅运行
- **安全可靠**：数据安全和持久化是首要考虑
- **可维护性**：代码结构清晰，易于测试和扩展

### 1.3 非功能需求回顾

| 需求类型 | 关键指标 | 技术应对 |
|---------|---------|---------|
| **性能** | 启动<2秒，统计图表<3秒 | 数据库优化、懒加载、预计算 |
| **数据安全** | 本地加密、自动备份 | Security Crypto、WorkManager |
| **兼容性** | Android 8.0+ (API 26) | 向后兼容测试、降级方案 |
| **数据规模** | 10,000+条记录流畅运行 | 索引优化、分页加载 |

## 2. 技术选型

### 2.1 技术栈决策矩阵

| 技术领域 | 候选方案 | 最终选择 | 决策理由 |
|---------|---------|---------|---------|
| **UI框架** | XML布局、Jetpack Compose | **Jetpack Compose** | 声明式UI，开发效率高，官方推荐 |
| **架构模式** | MVP、MVVM、MVI | **MVVM** | 数据驱动，配合Compose最佳实践 |
| **本地数据库** | SQLite、Room、Realm | **Room** | 官方ORM，类型安全，Flow支持 |
| **依赖注入** | Dagger、Hilt、Koin | **Hilt** | 专为Android优化，样板代码少 |
| **异步处理** | RxJava、Coroutines | **Kotlin Coroutines** | 轻量级，Kotlin原生，学习曲线平缓 |
| **图表库** | MPAndroidChart、Vico、Compose Charts | **Vico** | Compose原生，现代化API，自定义灵活 |
| **日期时间** | Java Time、Kotlinx DateTime | **Kotlinx DateTime** | 跨平台，时区处理安全 |

### 2.2 核心依赖库清单

**必需依赖**：
- Jetpack Compose：UI框架
- Room：数据持久化
- Hilt：依赖注入
- Kotlin Coroutines + Flow：异步编程
- Vico Chart：数据可视化
- Kotlinx Serialization：JSON序列化
- Kotlinx DateTime：日期时间处理
- Compose Navigation：应用导航

**辅助依赖**：
- AndroidX Security Crypto：数据加密
- WorkManager：后台任务调度
- DataStore：轻量级数据存储
- Timber：日志管理
- Coil：图片加载（图表导出）

**测试依赖**：
- JUnit5：单元测试框架
- Mockk：Kotlin Mock库
- Turbine：Flow测试
- Compose UI Test：UI测试

### 2.3 技术栈版本要求

| 技术 | 最低版本 | 推荐版本 | 说明 |
|-----|---------|---------|------|
| Kotlin | 1.9.0 | 最新稳定版 | 语言核心 |
| Compose | 1.5.0 | 最新稳定版 | UI框架 |
| Room | 2.6.0 | 最新稳定版 | 数据库 |
| Hilt | 2.48 | 最新稳定版 | DI框架 |
| Coroutines | 1.7.0 | 最新稳定版 | 异步处理 |

## 3. 架构设计

### 3.1 整体架构概览

```
┌─────────────────────────────────────────────────────┐
│                  Presentation Layer                 │
│    (UI Components, ViewModels, Navigation)          │
└──────────────────┬──────────────────────────────────┘
                   │ UI State / Events
                   ▼
┌─────────────────────────────────────────────────────┐
│                   Domain Layer                      │
│     (Use Cases, Business Logic, Domain Models)      │
└──────────────────┬──────────────────────────────────┘
                   │ Repository Interface
                   ▼
┌─────────────────────────────────────────────────────┐
│                    Data Layer                       │
│  (Repository Impl, Data Source, DAO, Entities)      │
└─────────────────────────────────────────────────────┘
```

**架构原则**：
- **依赖方向**：Presentation → Domain ← Data（依赖倒置）
- **数据流**：单向数据流（Unidirectional Data Flow）
- **职责分离**：每层只关注自己的职责
- **可测试性**：每层独立测试，Domain层无外部依赖

### 3.2 Clean Architecture 分层职责

#### 3.2.1 Presentation Layer（展示层）

**职责**：
- 接收用户交互事件
- 展示UI状态
- 将用户操作转换为业务指令

**核心组件**：
- **Composable函数**：UI声明
- **ViewModel**：状态管理和业务协调
- **UI State**：界面状态数据类
- **UI Event**：用户交互事件

**关键设计**：
- 使用 StateFlow 暴露UI状态
- 使用 Channel/SharedFlow 处理一次性事件
- ViewModel不持有Context或View引用

#### 3.2.2 Domain Layer（领域层）

**职责**：
- 封装业务逻辑
- 定义业务规则
- 协调数据操作

**核心组件**：
- **Use Case**：单一业务操作封装
- **Domain Model**：业务实体
- **Repository Interface**：数据访问接口

**关键设计**：
- Use Case遵循单一职责原则
- 不依赖任何Android框架
- 纯Kotlin代码，易于测试

#### 3.2.3 Data Layer（数据层）

**职责**：
- 数据持久化
- 数据源管理
- 数据转换映射

**核心组件**：
- **Repository Implementation**：仓储实现
- **Data Source**：数据来源（Local/Remote）
- **DAO**：数据库访问对象
- **Entity**：数据库实体

**关键设计**：
- 实现Domain层定义的Repository接口
- 处理数据源切换逻辑
- 使用Mapper进行Entity和Domain Model转换

### 3.3 模块化结构

```
blockwise/
├── app/                      # 应用入口模块
│   └── 职责：Application、MainActivity、DI配置
│
├── core/                     # 核心基础模块
│   ├── common/              # 通用工具
│   │   └── 职责：扩展函数、工具类、常量
│   ├── designsystem/        # 设计系统
│   │   └── 职责：主题、颜色、通用UI组件
│   ├── data/                # 数据层基础
│   │   └── 职责：数据库配置、基础实体
│   └── domain/              # 领域层基础
│       └── 职责：通用领域模型、Repository接口
│
└── feature/                  # 功能模块
    ├── timeentry/           # 时间记录
    │   ├── data/            # 数据层实现
    │   ├── domain/          # 业务逻辑
    │   └── presentation/    # UI展示
    ├── statistics/          # 统计分析
    ├── goal/                # 目标管理
    └── settings/            # 设置
```

**模块依赖关系**：
- feature模块 → core模块
- feature模块之间不直接依赖
- 通过core模块共享通用功能

**模块化优势**：
- 编译速度提升（并行编译）
- 代码隔离性强
- 功能独立测试
- 支持动态功能模块（未来扩展）

### 3.4 数据流设计

```
┌─────────────┐
│  UI Event   │ 用户点击按钮
└──────┬──────┘
       ▼
┌─────────────┐
│  ViewModel  │ 处理事件，调用Use Case
└──────┬──────┘
       ▼
┌─────────────┐
│  Use Case   │ 执行业务逻辑
└──────┬──────┘
       ▼
┌─────────────┐
│ Repository  │ 访问数据源
└──────┬──────┘
       ▼
┌─────────────┐
│     DAO     │ 数据库操作
└──────┬──────┘
       ▼
┌─────────────┐
│  Database   │ 数据持久化
└──────┬──────┘
       │
       ▼ (Flow 响应式流)
       │
┌──────┴──────┐
│  UI State   │ 界面更新
└─────────────┘
```

**关键特性**：
- **单向数据流**：数据流动方向清晰
- **响应式**：使用Flow实现数据自动更新
- **不可变性**：UI State使用不可变数据类
- **状态提升**：状态在ViewModel中统一管理

## 4. 数据模型设计

### 4.1 核心实体关系（ERD）

```
┌──────────────────────────────────────────────────────┐
│                    TimeEntry                         │
│  时间记录（核心实体）                                   │
├──────────────────────────────────────────────────────┤
│ - id: Long (PK)                                      │
│ - activityId: Long (FK → ActivityType)              │
│ - startTime: Instant                                 │
│ - endTime: Instant                                   │
│ - durationMinutes: Int                               │
│ - note: String?                                      │
│ - createdAt: Instant                                 │
│ - updatedAt: Instant                                 │
└───────────────┬──────────────────────────────────────┘
                │
                │ N:1
                ▼
┌──────────────────────────────────────────────────────┐
│                  ActivityType                        │
│  活动类型（支持层级结构）                               │
├──────────────────────────────────────────────────────┤
│ - id: Long (PK)                                      │
│ - name: String                                       │
│ - colorHex: String                                   │
│ - icon: String?                                      │
│ - parentId: Long? (FK → ActivityType, 自关联)        │
│ - displayOrder: Int                                  │
│ - isArchived: Boolean                                │
└──────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────┐
│                  TimeEntryTag                        │
│  时间记录-标签关联表（多对多）                           │
├──────────────────────────────────────────────────────┤
│ - entryId: Long (PK, FK → TimeEntry)                │
│ - tagId: Long (PK, FK → Tag)                        │
└───────────────┬──────────────────────────────────────┘
                │
                │ M:N
                ▼
┌──────────────────────────────────────────────────────┐
│                      Tag                             │
│  标签                                                 │
├──────────────────────────────────────────────────────┤
│ - id: Long (PK)                                      │
│ - name: String                                       │
│ - colorHex: String                                   │
│ - isArchived: Boolean                                │
└──────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────┐
│                      Goal                            │
│  目标                                                 │
├──────────────────────────────────────────────────────┤
│ - id: Long (PK)                                      │
│ - tagId: Long (FK → Tag)                            │
│ - targetMinutes: Int                                 │
│ - goalType: Enum (MIN, MAX, EXACT)                  │
│ - period: Enum (DAILY, WEEKLY, MONTHLY, CUSTOM)     │
│ - startDate: LocalDate?                              │
│ - endDate: LocalDate?                                │
│ - isActive: Boolean                                  │
└──────────────────────────────────────────────────────┘
```

### 4.2 数据库设计要点

#### 4.2.1 表设计原则

**TimeEntry（时间记录表）**：
- 主键：自增Long类型
- 索引：`activity_id`, `start_time`, `end_time`（高频查询字段）
- 外键：`activity_id` → ActivityType（RESTRICT删除策略）
- 时间存储：使用Instant（UTC时间戳）

**ActivityType（活动类型表）**：
- 支持层级结构：`parentId`自关联
- 索引：`parent_id`
- 软删除：`isArchived`字段，不物理删除

**Tag（标签表）**：
- 简单扁平结构
- 软删除：`isArchived`

**TimeEntryTag（关联表）**：
- 复合主键：`(entryId, tagId)`
- 级联删除：删除TimeEntry或Tag时自动删除关联

**Goal（目标表）**：
- 外键：`tagId` → Tag（CASCADE删除策略）
- 支持多种周期类型

#### 4.2.2 性能优化索引策略

| 表名 | 索引字段 | 索引类型 | 用途 |
|-----|---------|---------|------|
| time_entries | start_time | B-Tree | 按时间范围查询 |
| time_entries | activity_id | B-Tree | 按活动类型筛选 |
| time_entries | (start_time, activity_id) | 复合 | 统计查询优化 |
| activity_types | parent_id | B-Tree | 层级查询 |
| time_entry_tags | entry_id | B-Tree | 查找记录的标签 |
| time_entry_tags | tag_id | B-Tree | 查找标签的记录 |

#### 4.2.3 数据库视图设计

为提升统计查询性能，创建以下预聚合视图：

**DailyStatisticsView**：
- 按日期+活动类型聚合
- 字段：日期、活动ID、总时长、记录数
- 用途：日统计、周统计、月统计

**TagStatisticsView**：
- 按时间范围+标签聚合
- 字段：标签ID、总时长、记录数
- 用途：标签排名、目标进度

**HourlyDistributionView**：
- 按小时时段统计
- 字段：小时段、活动类型、总时长
- 用途：时段分布分析

### 4.3 数据转换策略

#### 4.3.1 三层数据模型

```
Database Entity (数据层)
    ↓ Mapper
Domain Model (领域层)
    ↓ Mapper
UI Model (展示层)
```

**Entity（数据库实体）**：
- Room实体注解
- 与数据库表一一对应
- 包含数据库相关字段（createAt、updatedAt等）

**Domain Model（领域模型）**：
- 纯Kotlin数据类
- 表达业务概念
- 不包含数据库细节

**UI Model（UI模型）**：
- 适配UI展示需求
- 包含格式化字段（如"2小时30分钟"）
- 可能合并多个Domain Model

#### 4.3.2 Mapper设计原则

- 单向转换：每个Mapper只负责一个方向
- 扩展函数：使用Kotlin扩展函数实现
- 统一位置：每个feature的data模块包含Mapper
- 测试覆盖：Mapper需要单元测试

### 4.4 数据类型转换器

Room TypeConverter处理特殊类型：
- **Instant** ↔ Long（时间戳）
- **LocalDate** ↔ String（ISO-8601格式）
- **Enum** ↔ String（枚举名称）
- **List<String>** ↔ String（JSON序列化）

## 5. 关键技术方案

### 5.1 时间记录计时器方案

#### 5.1.1 需求分析

- 精确计时（秒级精度）
- 支持暂停/继续
- 后台运行（切换应用不中断）
- 应用崩溃后恢复
- 通知栏显示

#### 5.1.2 技术方案

**核心技术**：Foreground Service + SharedPreferences

**方案概述**：
1. 使用Foreground Service确保后台运行
2. 使用SharedPreferences持久化计时器状态
3. 通知栏显示实时计时和操作按钮
4. 应用启动时检查是否有未完成的计时

**状态管理**：
- Idle（空闲）
- Running（运行中）
- Paused（暂停）

**数据持久化**：
```
计时器状态存储：
- timer_state: String (IDLE/RUNNING/PAUSED)
- start_time: Long (开始时间戳)
- elapsed_millis: Long (已用时长)
- activity_id: Long (活动类型ID)
```

**崩溃恢复流程**：
1. 应用启动时读取SharedPreferences
2. 如果发现Running或Paused状态
3. 显示恢复对话框，询问用户是否继续
4. 继续：恢复Service和计时
5. 放弃：保存为时间记录

#### 5.1.3 替代方案对比

| 方案 | 优点 | 缺点 | 是否采用 |
|-----|------|------|---------|
| Foreground Service | 后台可靠运行，通知栏控制 | 需要通知权限 | ✅ 采用 |
| WorkManager | 自动重试，系统优化 | 不保证精确执行时间 | ❌ 不适合 |
| AlarmManager | 精确时间触发 | 耗电，API限制多 | ❌ 不适合 |

### 5.2 时间块视图渲染方案

#### 5.2.1 需求分析

- 显示24小时时间轴
- 时间块按比例显示时长
- 支持拖拽调整时间
- 支持缩放调整密度
- 日视图和周视图切换

#### 5.2.2 技术方案

**核心技术**：Jetpack Compose Canvas + LazyColumn + 手势检测

**渲染策略**：
- 使用LazyColumn实现垂直滚动
- 每小时一个Item
- Canvas绘制时间块
- 手势检测处理交互

**性能优化**：
- 虚拟化渲染（LazyColumn只渲染可见项）
- 使用记忆化（remember）缓存计算结果
- derivedStateOf避免不必要重组
- 时间块复用key策略

**交互设计**：
- 单击：查看/编辑记录
- 长按：显示删除选项
- 拖拽：调整开始时间和时长
- 双指缩放：调整视图密度

#### 5.2.3 布局计算逻辑

**坐标系设计**：
- Y轴：时间轴（0-24小时）
- X轴：周视图时为日期
- 单位：像素 = 时长（分钟） × 比例系数

**重叠处理**：
- 同一时间多条记录：横向并列显示
- 最多显示3条，超出显示"更多"

### 5.3 统计数据聚合方案

#### 5.3.1 需求分析

- 多维度统计（日/周/月/年/自定义）
- 按标签、活动类型、时段统计
- 实时更新统计数据
- 大数据量性能优化

#### 5.3.2 技术方案

**核心技术**：Room Database View + Flow响应式流

**多层缓存策略**：
1. **数据库视图**：预聚合基础统计数据
2. **内存缓存**：缓存常用统计结果
3. **计算缓存**：使用remember缓存UI层计算

**数据聚合流程**：
```
原始数据（TimeEntry）
    ↓
数据库视图预聚合（DailyStatistics）
    ↓
Repository查询聚合
    ↓
Use Case业务逻辑处理
    ↓
ViewModel转换为UI State
    ↓
UI展示
```

**实时更新机制**：
- Room DAO返回Flow
- 数据变化时自动触发更新
- ViewModel收集Flow并转换为UI State
- UI自动响应状态变化

#### 5.3.3 统计查询优化

**查询优化策略**：
- 使用索引覆盖查询
- 避免SELECT *，只查询需要的字段
- 使用JOIN代替子查询
- 分页查询大数据集

**时间范围查询优化**：
- 使用BETWEEN优化日期范围查询
- 索引包含start_time字段
- 预计算时间边界（避免重复计算）

### 5.4 图表渲染方案

#### 5.4.1 需求分析

- 饼图、柱状图、折线图、面积图
- 交互式（点击、缩放、平移）
- 动画效果
- 可导出为图片

#### 5.4.2 技术方案

**核心库**：Vico Chart

**选择理由**：
- Compose原生，API现代化
- 性能优秀（Canvas渲染）
- 高度可定制
- 支持动画和交互
- 官方维护活跃

**图表类型实现**：

| 图表类型 | Vico组件 | 用途 |
|---------|---------|------|
| 饼图 | PieChart | 时间分配占比 |
| 柱状图 | ColumnChart | 时间趋势对比 |
| 折线图 | LineChart | 长期趋势分析 |
| 面积图 | LineChart + Fill | 累积分布展示 |

**性能优化**：
- 数据采样（大数据集显示关键点）
- 懒加载图表数据
- 图表复用（相同配置共享实例）

#### 5.4.3 图表导出方案

**导出为图片**：
- 使用Android Canvas截图
- Bitmap压缩优化
- 保存到相册或分享

**导出数据**：
- CSV格式：适合Excel打开
- JSON格式：结构化数据
- PDF报告：包含图表和文字说明

### 5.5 数据导入导出方案

#### 5.5.1 需求分析

- 支持JSON和CSV格式
- 批量导入历史数据
- 数据校验和冲突处理
- 增量导出

#### 5.5.2 技术方案

**JSON格式**：
- 使用Kotlinx Serialization
- 包含完整数据结构（Entry、Activity、Tag）
- 版本标识（兼容性处理）

**CSV格式**：
- 使用Apache Commons CSV
- 表格格式，适合Excel编辑
- 仅导出TimeEntry（扁平结构）

**导入流程**：
```
文件选择
    ↓
格式识别
    ↓
数据解析
    ↓
数据校验（时间有效性、外键完整性）
    ↓
冲突检测（重复数据）
    ↓
用户确认
    ↓
事务批量插入
    ↓
导入完成反馈
```

**数据校验规则**：
- 时间有效性：startTime < endTime
- 外键完整性：activityId、tagId存在
- 重复检测：相同时间范围的记录
- 数据格式：JSON/CSV格式正确性

#### 5.5.3 备份恢复方案

**自动备份**：
- 使用WorkManager定期执行
- 默认每天备份一次
- 保留最近30天备份
- 备份到应用私有目录

**云端备份（可选）**：
- 集成Google Drive API
- 用户授权后自动同步
- 加密后上传
- 支持多设备同步

## 6. 性能优化策略

### 6.1 数据库性能优化

#### 6.1.1 索引策略

**原则**：
- 高频查询字段建立索引
- 避免过度索引（影响写入性能）
- 复合索引优化多条件查询

**索引设计**：
- 单字段索引：start_time、activity_id
- 复合索引：(start_time, activity_id)用于统计查询

#### 6.1.2 查询优化

- 避免N+1查询问题（使用JOIN）
- 使用数据库视图预聚合
- 查询结果分页加载
- 批量操作使用Transaction

#### 6.1.3 写入优化

- 批量插入使用单次Transaction
- 异步写入（协程）
- 延迟写入（合并短时间内的多次写入）

### 6.2 UI渲染性能优化

#### 6.2.1 Compose优化技巧

**避免不必要的重组**：
- 使用remember缓存计算结果
- 使用derivedStateOf派生状态
- 稳定的key提升列表性能

**优化列表渲染**：
- LazyColumn虚拟化渲染
- 稳定key（避免重新创建Item）
- Item复用（相同类型共享布局）

**状态管理优化**：
- 状态下放（只在需要的地方订阅）
- 避免在Composable中直接计算
- 使用Immutable数据类

#### 6.2.2 内存优化

- 及时取消协程（ViewModel清理）
- 使用序列（Sequence）处理大数据集
- 图片资源使用WeakReference缓存
- 避免内存泄漏（Context引用）

#### 6.2.3 启动优化

- 延迟初始化非必要组件
- 使用Startup Library管理初始化
- 预加载关键数据
- 异步初始化第三方SDK

### 6.3 性能监控

**关键指标**：
- 启动时间（冷启动、温启动）
- 界面渲染帧率（保持60fps）
- 数据库查询耗时
- 内存使用峰值

**监控工具**：
- Android Profiler（开发阶段）
- Firebase Performance Monitoring（生产环境）
- 自定义埋点（关键操作耗时）

### 6.4 性能优化目标

| 性能指标 | 目标值 | 测量条件 |
|---------|-------|---------|
| 冷启动时间 | < 2秒 | Android 8.0设备 |
| 统计图表加载 | < 3秒 | 10,000条记录 |
| 时间线滚动帧率 | 60fps | 1000条记录 |
| 数据库查询 | < 100ms | 单表查询 |
| 内存占用 | < 150MB | 正常使用 |

## 7. 数据安全与隐私

### 7.1 数据加密

#### 7.1.1 敏感数据加密存储

**SharedPreferences加密**：
- 使用AndroidX Security Crypto
- EncryptedSharedPreferences
- AES256-GCM加密算法

**数据库加密（可选）**：
- 集成SQLCipher
- 全库加密
- 用户设置主密码

#### 7.1.2 数据传输安全

- HTTPS传输（如有云端同步）
- 证书固定（Certificate Pinning）
- 防中间人攻击

### 7.2 数据备份策略

#### 7.2.1 本地备份

**自动备份**：
- 每日自动备份（WorkManager）
- 保留最近30天
- 存储到应用私有目录

**手动备份**：
- 用户主动触发导出
- 选择保存位置
- 支持分享到云存储

#### 7.2.2 云端备份（可选）

**Google Drive集成**：
- 用户授权后启用
- 增量同步
- 端到端加密
- 支持多设备同步

#### 7.2.3 备份恢复流程

```
备份文件选择
    ↓
格式验证
    ↓
数据解密（如有加密）
    ↓
数据完整性校验
    ↓
冲突策略选择（覆盖/合并/跳过）
    ↓
数据恢复
    ↓
完成反馈
```

### 7.3 隐私保护

- 所有数据本地存储（无必要不上传）
- 云端同步需用户明确授权
- 数据导出前用户确认
- 遵守GDPR和数据保护法规
- 提供数据删除功能

### 7.4 数据迁移

#### 7.4.1 版本升级迁移

- Room Migration自动处理
- 向后兼容旧版本数据
- 迁移失败回滚机制

#### 7.4.2 跨设备迁移

- 导出/导入功能
- 云端同步（可选）
- 二维码快速传输（局域网）

## 8. 测试策略

### 8.1 测试金字塔

```
        ┌─────────────────┐
        │   UI Tests      │  10%  (E2E测试)
        │   (Slow)        │
        └─────────────────┘
       ┌─────────────────────┐
       │ Integration Tests   │  20%  (集成测试)
       │   (Medium)          │
       └─────────────────────┘
     ┌───────────────────────────┐
     │     Unit Tests            │  70%  (单元测试)
     │     (Fast)                │
     └───────────────────────────┘
```

### 8.2 单元测试

**测试范围**：
- ViewModel逻辑测试
- Use Case业务逻辑测试
- Repository数据访问测试
- Mapper转换测试
- 工具函数测试

**测试框架**：
- JUnit5
- Mockk（Mock框架）
- Turbine（Flow测试）
- Coroutines Test（协程测试）

**测试原则**：
- 每个公共方法都有测试
- 测试边界条件
- 测试异常情况
- 测试命名清晰（given-when-then）

### 8.3 集成测试

**测试范围**：
- Repository + DAO集成
- ViewModel + Use Case集成
- 多模块协作测试

**测试策略**：
- 使用内存数据库（Room.inMemoryDatabase）
- 模拟真实数据流
- 测试事务完整性

### 8.4 UI测试

**测试范围**：
- 关键用户流程
- 界面元素可见性
- 用户交互响应
- 导航流程

**测试框架**：
- Compose UI Test
- Espresso（必要时）

**测试用例**：
- 创建时间记录流程
- 统计图表展示
- 目标管理流程
- 数据导入导出

### 8.5 性能测试

**测试内容**：
- 启动时间测试
- 大数据量性能测试
- 内存泄漏检测
- 电池消耗测试

**测试工具**：
- Android Profiler
- LeakCanary
- Macrobenchmark

### 8.6 测试覆盖率目标

| 层级 | 覆盖率目标 | 优先级 |
|-----|----------|-------|
| Domain Layer | 90%+ | 最高 |
| Data Layer | 85%+ | 高 |
| Presentation Layer | 80%+ | 高 |
| UI Layer | 60%+ | 中 |
| **整体** | **75%+** | - |

## 9. 文档版本历史

| 版本 | 日期 | 修订内容 | 作者 |
|-----|------|---------|------|
| v1.0 | 2026-01-15 | 初始版本 | Tech Team |

---

**文档状态**:审核完毕
